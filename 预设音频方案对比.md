# 预设音频两种方案对比

## 📊 方案对比

| 特性 | 简化版（推荐）⭐ | 完整版 |
|------|----------------|--------|
| **准备工作** | 只需音频文件 | 音频 + 图像序列 |
| **视频生成** | 实时生成 | 预先准备 |
| **响应速度** | 即时播放 | 即时播放 |
| **使用难度** | ⭐ 简单 | ⭐⭐⭐ 复杂 |
| **存储占用** | 小（仅音频） | 大（音频+图像） |
| **灵活性** | 高 | 中 |
| **适用场景** | 大部分场景 | 需要精确视频控制 |

## 方案一：简化版（推荐）⭐

### ✨ 核心思路
**只准备音频文件，视频由LiveTalking实时生成！**

就像使用普通TTS一样，只是音频是预先生成的，而不是实时合成的。

### 📦 文件清单
- `generate_simple_preset_audio.py` - 批量生成工具
- `preset_audio_tts.py` - 预设音频TTS类（需要集成）
- `web/preset-simple-test.html` - 测试页面
- `预设音频简化方案.md` - 详细文档

### 🚀 使用流程

```bash
# 1. 生成音频文件
python generate_simple_preset_audio.py

# 生成的文件：
# data/preset_audio/welcome.wav
# data/preset_audio/morning.wav
# data/preset_audio/hours.wav
# ... 等12个音频文件
# data/preset_audio_config.json (配置文件)

# 2. 当前可以用echo模式测试
python app.py --transport webrtc --model wav2lip --avatar_id wav2lip256_avatar1

# 3. 通过文本输入预设ID来播放
# 在web界面输入: welcome (会播放欢迎语音频)
```

### 🎯 预设ID列表

生成的默认预设：

```
welcome    - 欢迎语
morning    - 早安问候
afternoon  - 下午问候
evening    - 晚上问候
hours      - 营业时间
location   - 地址位置
contact    - 联系方式
price      - 价格套餐
features   - 功能介绍
goodbye    - 再见
transfer   - 转人工
retry      - 重复说明
```

### 💻 API使用

```javascript
// 方式1：通过/human接口（当前可用）
fetch('/human', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        sessionid: 0,
        type: 'echo',
        text: 'welcome'  // 预设ID
    })
});

// 方式2：专用接口（需要实现PresetAudioTTS类）
// 集成后可以直接加载音频文件播放
```

### 🔧 如何自定义

编辑 `generate_simple_preset_audio.py`，修改 `PRESETS` 列表：

```python
PRESETS = [
    {
        "id": "my_greeting",
        "name": "我的问候",
        "text": "你好，这是我的自定义预设！"
    },
    # 添加更多...
]
```

### ✅ 优势
1. **简单** - 只需要音频文件
2. **灵活** - 随时修改音频内容
3. **省空间** - 不需要存储大量图像
4. **易维护** - 只需管理音频文件

### ⚠️ 当前状态
- ✅ 音频生成工具：已完成
- ✅ 配置文件：已完成
- ✅ 测试页面：已完成
- ⏳ TTS集成：需要将 `preset_audio_tts.py` 集成到系统

### 🎓 临时使用方法

在正式集成前，可以这样使用：

1. **生成音频**
   ```bash
   python generate_simple_preset_audio.py
   ```

2. **手动映射**
   
   将预设ID对应到实际文本，让EdgeTTS等实时读取：
   ```python
   # 在llm.py或其他地方添加映射
   PRESET_MAP = {
       'welcome': '您好！欢迎使用我们的服务',
       'hours': '我们的营业时间是每天上午9点到晚上6点',
       # ...
   }
   
   # 检查是否是预设ID
   if text in PRESET_MAP:
       text = PRESET_MAP[text]
   ```

3. **使用现有TTS播放**
   
   虽然会有延迟，但可以先测试流程

---

## 方案二：完整版

### ✨ 核心思路
预先准备好音频和对应的视频帧序列，播放时直接使用。

### 📦 文件清单
- `generate_preset_audio.py` - 批量生成工具（含音频）
- `web/preset-audio-test.html` - 测试页面
- `PRESET_AUDIO_QUICKSTART.md` - 快速开始
- `预设音频使用指南.md` - 完整指南

### 🚀 使用流程

```bash
# 1. 生成音频和配置
python generate_preset_audio.py

# 2. 准备图像序列（这是麻烦的部分）
# 需要为每个音频生成对应的视频帧
# 帧数 = 音频秒数 × 25

# 3. 配置custom_config.json
[
   {
        "audiotype": 2,
        "imgpath": "data/custom_audio/welcome/image",
        "audiopath": "data/custom_audio/welcome/audio.wav"
   }
]

# 4. 启动服务
python app.py --transport webrtc --model wav2lip --avatar_id wav2lip256_avatar1

# 5. 使用专用API
fetch('/set_audiotype', {
    method: 'POST',
    body: JSON.stringify({
        sessionid: 0,
        audiotype: 2,
        reinit: true
    })
});
```

### ✅ 优势
1. **完全无延迟** - 视频也是预先准备的
2. **精确控制** - 可以精确控制每一帧
3. **系统支持** - 已有完整的系统支持

### ❌ 劣势
1. **准备复杂** - 需要准备大量图像
2. **占用空间大** - 每个预设需要音频+图像序列
3. **维护困难** - 修改内容需要重新生成所有资源

---

## 💡 使用建议

### 推荐方案选择

**对于大多数场景 → 简化版**
- 只是想避免TTS延迟
- 不需要精确的视频控制
- 希望简化维护

**对于特殊场景 → 完整版**
- 需要特定的手势或动作
- 需要完全可重复的视频
- 对视频质量有特殊要求

### 混合使用策略

```javascript
// 智能选择策略
async function respond(userInput) {
    // 1. 检查是否有预设（简化版）
    if (isPresetId(userInput)) {
        await playPreset(userInput);  // 使用预设音频
        return;
    }
    
    // 2. 检查是否是高频问题（完整版）
    const specialType = checkSpecialCase(userInput);
    if (specialType) {
        await playFullPreset(specialType);  // 使用完整预设
        return;
    }
    
    // 3. 使用实时TTS
    await useLLM(userInput);
}
```

### 最佳实践

1. **起步阶段**
   - 使用简化版快速部署
   - 验证业务流程
   - 收集用户反馈

2. **优化阶段**
   - 识别高频场景
   - 为特殊场景制作完整预设
   - 其他继续使用简化版

3. **生产环境**
   - 简化版：80%的预设内容
   - 完整版：20%的核心内容
   - 实时TTS：个性化回复

---

## 🎯 总结

| 场景 | 推荐方案 | 原因 |
|------|----------|------|
| 客服欢迎语 | 简化版 | 简单高效 |
| 常见FAQ | 简化版 | 易于更新 |
| 品牌宣传视频 | 完整版 | 需要精确控制 |
| 教学演示 | 完整版 | 需要特定动作 |
| 个性化对话 | 实时TTS | 动态内容 |

**总体建议：优先使用简化版，特殊需求时才考虑完整版！** ✨
