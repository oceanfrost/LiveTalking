# é¢„è®¾éŸ³é¢‘ç®€åŒ–æ–¹æ¡ˆ - åªéœ€éŸ³é¢‘ï¼Œè§†é¢‘å®æ—¶ç”Ÿæˆ

## ğŸ’¡ æ ¸å¿ƒæ€è·¯

**åªå‡†å¤‡éŸ³é¢‘æ–‡ä»¶ï¼Œè®©ç³»ç»Ÿå®æ—¶ç”Ÿæˆè§†é¢‘ï¼**

- âœ… åªéœ€è¦é¢„å…ˆç”ŸæˆéŸ³é¢‘æ–‡ä»¶ï¼ˆWAVæ ¼å¼ï¼‰
- âœ… è§†é¢‘ç”±LiveTalkingå®æ—¶æ¸²æŸ“ï¼ˆå’Œæ™®é€šTTSä¸€æ ·ï¼‰
- âŒ ä¸éœ€è¦é¢„å…ˆå‡†å¤‡å›¾åƒåºåˆ—
- âŒ ä¸éœ€è¦æ‰‹åŠ¨æ•è·è§†é¢‘å¸§

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ2æ­¥ï¼‰

### ç¬¬1æ­¥ï¼šå‡†å¤‡éŸ³é¢‘æ–‡ä»¶

åˆ›å»ºç›®å½•å¹¶æ”¾ç½®éŸ³é¢‘æ–‡ä»¶ï¼š

```bash
# åˆ›å»ºç›®å½•
mkdir -p data/preset_audio

# å‡†å¤‡éŸ³é¢‘æ–‡ä»¶ï¼ˆ16kHz WAVæ ¼å¼ï¼‰
# å¯ä»¥ä½¿ç”¨EdgeTTSã€GPT-SoVITSç­‰å·¥å…·ç”Ÿæˆ
```

**ç”ŸæˆéŸ³é¢‘çš„å‡ ç§æ–¹æ³•ï¼š**

#### æ–¹æ³•Aï¼šä½¿ç”¨EdgeTTSç”Ÿæˆï¼ˆæ¨èï¼‰

```python
import asyncio
import edge_tts

async def generate_audio(text, output_path):
    communicate = edge_tts.Communicate(text, "zh-CN-YunxiaNeural")
    await communicate.save(output_path)

# ç”Ÿæˆæ¬¢è¿è¯­
asyncio.run(generate_audio(
    "æ‚¨å¥½ï¼æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ",
    "data/preset_audio/welcome.wav"
))

# ç”Ÿæˆå¸¸è§é—®é¢˜å›ç­”
asyncio.run(generate_audio(
    "æˆ‘ä»¬çš„è¥ä¸šæ—¶é—´æ˜¯æ¯å¤©ä¸Šåˆ9ç‚¹åˆ°æ™šä¸Š6ç‚¹",
    "data/preset_audio/hours.wav"
))
```

#### æ–¹æ³•Bï¼šä½¿ç”¨æä¾›çš„æ‰¹é‡ç”Ÿæˆå·¥å…·

```bash
python generate_simple_preset_audio.py
```

ï¼ˆä¸‹é¢ä¼šæä¾›è¿™ä¸ªå·¥å…·ï¼‰

#### æ–¹æ³•Cï¼šä½¿ç”¨å…¶ä»–TTSæœåŠ¡

ä½¿ç”¨ä»»ä½•TTSæœåŠ¡ç”ŸæˆéŸ³é¢‘ï¼Œç„¶åè½¬æ¢ä¸º16kHz WAVæ ¼å¼ã€‚

### ç¬¬2æ­¥ï¼šé…ç½®é¢„è®¾åˆ—è¡¨

åˆ›å»º `data/preset_audio_config.json`ï¼š

```json
[
  {
    "id": "welcome",
    "name": "æ¬¢è¿è¯­",
    "text": "æ‚¨å¥½ï¼æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡",
    "audio_path": "data/preset_audio/welcome.wav"
  },
  {
    "id": "hours",
    "name": "è¥ä¸šæ—¶é—´",
    "text": "æˆ‘ä»¬çš„è¥ä¸šæ—¶é—´æ˜¯æ¯å¤©ä¸Šåˆ9ç‚¹åˆ°æ™šä¸Š6ç‚¹",
    "audio_path": "data/preset_audio/hours.wav"
  },
  {
    "id": "goodbye",
    "name": "å†è§",
    "text": "æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼Œå†è§ï¼",
    "audio_path": "data/preset_audio/goodbye.wav"
  }
]
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
python app.py --transport webrtc --model wav2lip --avatar_id wav2lip256_avatar1 --tts preset
```

æ³¨æ„ï¼šæ·»åŠ  `--tts preset` å‚æ•°ä½¿ç”¨é¢„è®¾éŸ³é¢‘TTSã€‚

### ç¬¬4æ­¥ï¼šä½¿ç”¨APIæ’­æ”¾

```javascript
// æ’­æ”¾æ¬¢è¿è¯­
fetch('http://localhost:8010/human', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        sessionid: 0,
        type: 'echo',
        text: 'welcome'  // ä½¿ç”¨é¢„è®¾ID
    })
});

// æ’­æ”¾è¥ä¸šæ—¶é—´è¯´æ˜
fetch('http://localhost:8010/human', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        sessionid: 0,
        type: 'echo',
        text: 'hours'
    })
});
```

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### 1. æ‰¹é‡ç”Ÿæˆå·¥å…·

ä¿å­˜ä¸º `generate_simple_preset_audio.py`ï¼š

```python
import asyncio
import edge_tts
import json
import os

# å®šä¹‰è¦ç”Ÿæˆçš„é¢„è®¾éŸ³é¢‘
PRESETS = [
    {
        "id": "welcome",
        "name": "æ¬¢è¿è¯­",
        "text": "æ‚¨å¥½ï¼æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œæˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ"
    },
    {
        "id": "morning",
        "name": "æ—©å®‰",
        "text": "æ—©ä¸Šå¥½ï¼æ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼Œç¥æ‚¨å·¥ä½œé¡ºåˆ©ï¼"
    },
    {
        "id": "hours",
        "name": "è¥ä¸šæ—¶é—´",
        "text": "æˆ‘ä»¬çš„è¥ä¸šæ—¶é—´æ˜¯æ¯å¤©ä¸Šåˆ9ç‚¹åˆ°æ™šä¸Š6ç‚¹ï¼Œå‘¨æœ«å’ŒèŠ‚å‡æ—¥æ­£å¸¸è¥ä¸šã€‚"
    },
    {
        "id": "location",
        "name": "åœ°å€",
        "text": "æˆ‘ä»¬çš„åœ°å€åœ¨åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—123å·ï¼Œåœ°é“4å·çº¿ä¸­å…³æ‘ç«™Aå£å‡ºæ¥æ­¥è¡Œ5åˆ†é’Ÿã€‚"
    },
    {
        "id": "price",
        "name": "ä»·æ ¼",
        "text": "æˆ‘ä»¬æä¾›å¤šç§å¥—é¤ï¼šåŸºç¡€ç‰ˆæ¯æœˆ299å…ƒï¼Œä¸“ä¸šç‰ˆæ¯æœˆ599å…ƒï¼Œä¼ä¸šç‰ˆæ¯æœˆ999å…ƒã€‚"
    },
    {
        "id": "goodbye",
        "name": "å†è§",
        "text": "æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶æ¬¢è¿å›æ¥ã€‚ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼Œå†è§ï¼"
    },
]

VOICE = "zh-CN-YunxiaNeural"  # å¯æ›´æ¢å…¶ä»–è¯­éŸ³
OUTPUT_DIR = "data/preset_audio"

async def generate_one(preset):
    """ç”Ÿæˆå•ä¸ªéŸ³é¢‘æ–‡ä»¶"""
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    
    audio_path = os.path.join(OUTPUT_DIR, f"{preset['id']}.wav")
    print(f"æ­£åœ¨ç”Ÿæˆ: {preset['name']} ({preset['id']})...")
    
    try:
        communicate = edge_tts.Communicate(preset['text'], VOICE)
        await communicate.save(audio_path)
        print(f"  âœ“ å·²ä¿å­˜: {audio_path}")
        
        # æ›´æ–°é…ç½®ä¸­çš„è·¯å¾„
        preset['audio_path'] = audio_path
        return preset
    except Exception as e:
        print(f"  âœ— å¤±è´¥: {e}")
        return None

async def main():
    print("=" * 60)
    print("å¼€å§‹ç”Ÿæˆé¢„è®¾éŸ³é¢‘...")
    print("=" * 60)
    
    # å¹¶å‘ç”Ÿæˆæ‰€æœ‰éŸ³é¢‘
    tasks = [generate_one(preset) for preset in PRESETS]
    results = await asyncio.gather(*tasks)
    
    # è¿‡æ»¤æ‰å¤±è´¥çš„
    config = [r for r in results if r is not None]
    
    # ç”Ÿæˆé…ç½®æ–‡ä»¶
    config_path = "data/preset_audio_config.json"
    with open(config_path, 'w', encoding='utf-8') as f:
        json.dump(config, f, ensure_ascii=False, indent=2)
    
    print("\n" + "=" * 60)
    print(f"âœ… å®Œæˆï¼å…±ç”Ÿæˆ {len(config)} ä¸ªéŸ³é¢‘æ–‡ä»¶")
    print(f"é…ç½®æ–‡ä»¶: {config_path}")
    print("=" * 60)
    print("\nä¸‹ä¸€æ­¥ï¼š")
    print("  python app.py --tts preset --model wav2lip ...")

if __name__ == "__main__":
    asyncio.run(main())
```

### 2. Webæµ‹è¯•é¡µé¢

ä¿å­˜ä¸º `web/preset-simple-test.html`ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é¢„è®¾éŸ³é¢‘æµ‹è¯• - ç®€åŒ–ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .preset-btn {
            display: inline-block;
            margin: 10px;
            padding: 15px 30px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .preset-btn:hover {
            background: #45a049;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ™ï¸ é¢„è®¾éŸ³é¢‘æµ‹è¯•</h1>
    <p>ç‚¹å‡»æŒ‰é’®æ’­æ”¾é¢„è®¾éŸ³é¢‘ï¼ˆè§†é¢‘å®æ—¶ç”Ÿæˆï¼‰</p>
    
    <div>
        <button class="preset-btn" onclick="play('welcome')">æ¬¢è¿è¯­</button>
        <button class="preset-btn" onclick="play('morning')">æ—©å®‰</button>
        <button class="preset-btn" onclick="play('hours')">è¥ä¸šæ—¶é—´</button>
        <button class="preset-btn" onclick="play('location')">åœ°å€</button>
        <button class="preset-btn" onclick="play('price')">ä»·æ ¼</button>
        <button class="preset-btn" onclick="play('goodbye')">å†è§</button>
    </div>
    
    <div class="status" id="status">å°±ç»ª</div>
    
    <script>
        async function play(presetId) {
            document.getElementById('status').textContent = `æ­£åœ¨æ’­æ”¾: ${presetId}...`;
            
            try {
                const response = await fetch('/human', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        sessionid: 0,
                        type: 'echo',
                        text: presetId
                    })
                });
                
                const result = await response.json();
                if (result.code === 0) {
                    document.getElementById('status').textContent = `âœ“ æ’­æ”¾æˆåŠŸ: ${presetId}`;
                } else {
                    document.getElementById('status').textContent = `âœ— æ’­æ”¾å¤±è´¥: ${result.msg}`;
                }
            } catch (error) {
                document.getElementById('status').textContent = `âœ— é”™è¯¯: ${error.message}`;
            }
        }
    </script>
</body>
</html>
```

## ğŸ”§ é›†æˆåˆ°ç³»ç»Ÿ

### ä¿®æ”¹ basereal.py

åœ¨ `BaseReal.__init__` ä¸­æ·»åŠ é¢„è®¾éŸ³é¢‘TTSé€‰é¡¹ï¼š

```python
# åœ¨ tts åˆå§‹åŒ–éƒ¨åˆ†æ·»åŠ 
elif opt.tts == "preset":
    from preset_audio_tts import PresetAudioTTS
    self.tts = PresetAudioTTS(opt, self)
```

### ä¿®æ”¹ app.py

æ·»åŠ å‘½ä»¤è¡Œå‚æ•°è¯´æ˜ï¼š

```python
parser.add_argument('--tts', type=str, default='edgetts', 
    help="ttsç±»å‹: edgetts, gpt-sovits, preset, ...") 
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ™ºèƒ½å®¢æœ

```javascript
const FAQ_MAP = {
    'è¥ä¸šæ—¶é—´': 'hours',
    'åœ°å€': 'location',
    'ä»·æ ¼': 'price'
};

async function handleQuestion(question) {
    // æ£€æŸ¥æ˜¯å¦åŒ¹é…é¢„è®¾é—®é¢˜
    for (let [keyword, presetId] of Object.entries(FAQ_MAP)) {
        if (question.includes(keyword)) {
            await play(presetId);
            return;
        }
    }
    
    // ä¸åŒ¹é…åˆ™ä½¿ç”¨LLM
    await chatWithLLM(question);
}
```

### åœºæ™¯2ï¼šå®šæ—¶é—®å€™

```javascript
function autoGreeting() {
    const hour = new Date().getHours();
    let greeting = 'welcome';
    
    if (hour >= 5 && hour < 12) greeting = 'morning';
    else if (hour >= 18) greeting = 'evening';
    
    play(greeting);
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨é—®å€™
window.onload = autoGreeting;
```

## âš¡ ä¼˜åŠ¿å¯¹æ¯”

| æ–¹æ¡ˆ | å‡†å¤‡å·¥ä½œ | å“åº”é€Ÿåº¦ | çµæ´»æ€§ |
|------|---------|---------|--------|
| **ç®€åŒ–æ–¹æ¡ˆ** | åªéœ€éŸ³é¢‘ | å³æ—¶ | é«˜ |
| å®Œæ•´é¢„è®¾ | éŸ³é¢‘+å›¾åƒ | å³æ—¶ | ä¸­ |
| å®æ—¶TTS | æ—  | 1-3ç§’ | æœ€é«˜ |

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **éŸ³é¢‘æ ¼å¼**ï¼šæ¨è16kHz, å•å£°é“, WAVæ ¼å¼
2. **éŸ³é¢‘æ—¶é•¿**ï¼šå»ºè®®æ¯ä¸ªé¢„è®¾ä¸è¶…è¿‡30ç§’
3. **IDå‘½å**ï¼šä½¿ç”¨è‹±æ–‡ï¼Œç®€æ´æ˜äº†
4. **å†…å­˜å ç”¨**ï¼šæ‰€æœ‰é¢„è®¾éŸ³é¢‘åŠ è½½åˆ°å†…å­˜ï¼Œæ³¨æ„æ•°é‡

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¸¸ç”¨é¢„è®¾**ï¼ˆ5-20ä¸ªï¼‰
   - æ¬¢è¿è¯­ã€å†è§
   - é«˜é¢‘é—®é¢˜ï¼ˆè¥ä¸šæ—¶é—´ã€åœ°å€ã€ä»·æ ¼ç­‰ï¼‰
   - å®šæ—¶é—®å€™

2. **åŠ¨æ€å†…å®¹**
   - ä½¿ç”¨å®æ—¶TTSæˆ–LLM
   - ä¸ªæ€§åŒ–å›å¤

3. **æ··åˆç­–ç•¥**
   ```javascript
   if (isCommonQuestion(text)) {
       playPreset(getPresetId(text));  // ä½¿ç”¨é¢„è®¾
   } else {
       useLLM(text);  // ä½¿ç”¨LLM
   }
   ```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°é¢„è®¾
- æ£€æŸ¥ `data/preset_audio_config.json` æ˜¯å¦å­˜åœ¨
- ç¡®è®¤é¢„è®¾IDæ‹¼å†™æ­£ç¡®
- æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—

### é—®é¢˜ï¼šéŸ³é¢‘æ— æ³•æ’­æ”¾
- ç¡®è®¤éŸ³é¢‘æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥éŸ³é¢‘æ ¼å¼ï¼ˆ16kHz WAVï¼‰
- æŸ¥çœ‹æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šè§†é¢‘ä¸åŒæ­¥
- è¿™ç§æ–¹æ¡ˆè§†é¢‘æ˜¯å®æ—¶ç”Ÿæˆçš„ï¼Œåº”è¯¥ä¼šè‡ªåŠ¨åŒæ­¥
- å¦‚æœæœ‰é—®é¢˜ï¼Œæ£€æŸ¥GPUæ€§èƒ½

## ğŸ“¦ å®Œæ•´å·¥ä½œæµ

```bash
# 1. ç”ŸæˆéŸ³é¢‘
python generate_simple_preset_audio.py

# 2. æ£€æŸ¥é…ç½®
cat data/preset_audio_config.json

# 3. å¯åŠ¨æœåŠ¡
python app.py --tts preset --model wav2lip --avatar_id wav2lip256_avatar1 --transport webrtc

# 4. æµ‹è¯•
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8010/preset-simple-test.html
```

---

**è¿™ä¸ªæ–¹æ¡ˆå¤§å¤§ç®€åŒ–äº†é¢„è®¾éŸ³é¢‘çš„ä½¿ç”¨ï¼åªéœ€è¦éŸ³é¢‘æ–‡ä»¶ï¼Œè§†é¢‘å®æ—¶ç”Ÿæˆï¼Œå®Œç¾ï¼** ğŸ‰
