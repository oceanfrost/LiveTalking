# é¢„è®¾éŸ³é¢‘åŠŸèƒ½å¿«é€Ÿå¼€å§‹

## ğŸ“‹ ç®€ä»‹

é¢„è®¾éŸ³é¢‘åŠŸèƒ½å…è®¸æ‚¨ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶æ¥é©±åŠ¨æ•°å­—äººï¼Œå®ç°**é›¶å»¶è¿Ÿ**å“åº”ã€‚éå¸¸é€‚åˆï¼š
- âœ… æ¬¢è¿è¯­ã€é—®å€™è¯­
- âœ… å¸¸è§é—®é¢˜å›ç­”ï¼ˆFAQï¼‰
- âœ… å›ºå®šè¯æœ¯
- âœ… ç´§æ€¥é€šçŸ¥

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥æå®šï¼‰

### ç¬¬1æ­¥ï¼šç”Ÿæˆé¢„è®¾éŸ³é¢‘

è¿è¡Œè¾…åŠ©è„šæœ¬è‡ªåŠ¨ç”ŸæˆéŸ³é¢‘æ–‡ä»¶å’Œé…ç½®ï¼š

```bash
python generate_preset_audio.py
```

è¿™å°†è‡ªåŠ¨ï¼š
- ç”Ÿæˆ13ä¸ªå¸¸ç”¨é¢„è®¾éŸ³é¢‘æ–‡ä»¶
- åˆ›å»º `data/custom_config.json` é…ç½®æ–‡ä»¶
- åˆ›å»º `data/preset_mapping.json` æ˜ å°„æ–‡ä»¶

### ç¬¬2æ­¥ï¼šå‡†å¤‡å›¾åƒåºåˆ—

**é€‰é¡¹Aï¼šä½¿ç”¨ç°æœ‰å›¾åƒåºåˆ—ï¼ˆæ¨èï¼‰**

å¦‚æœæ‚¨å·²ç»æœ‰æ•°å­—äººçš„å›¾åƒåºåˆ—ï¼Œç›´æ¥å¤åˆ¶åˆ°å¯¹åº”ç›®å½•ï¼š

```bash
# å°†å›¾åƒåºåˆ—å¤åˆ¶åˆ°å¯¹åº”ç›®å½•
cp -r your_images/* data/custom_audio/welcome/image/
cp -r your_images/* data/custom_audio/greeting_morning/image/
# ... å…¶ä»–é¢„è®¾
```

**é€‰é¡¹Bï¼šä½¿ç”¨LiveTalkingç”Ÿæˆå›¾åƒåºåˆ—**

1. å¯åŠ¨LiveTalkingæœåŠ¡
2. é€šè¿‡Webç•Œé¢æˆ–APIå‘é€æ–‡æœ¬ï¼Œè®©æ•°å­—äººè¯´è¯
3. ä½¿ç”¨å½•åˆ¶åŠŸèƒ½ä¿å­˜
4. ä»å½•åˆ¶è§†é¢‘ä¸­æå–å›¾åƒå¸§

**é€‰é¡¹Cï¼šä½¿ç”¨ç®€åŒ–æ–¹æ¡ˆï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰**

å¯¹äºå¿«é€Ÿæµ‹è¯•ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨åŒä¸€ç»„å›¾åƒï¼š

```bash
# ä¸ºæ‰€æœ‰é¢„è®¾ä½¿ç”¨ç›¸åŒçš„å›¾åƒåºåˆ—
for dir in data/custom_audio/*/; do
    cp -r data/custom_audio/welcome/image/* "$dir/image/" 2>/dev/null || true
done
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨æœåŠ¡å¹¶æµ‹è¯•

1. **å¯åŠ¨LiveTalkingæœåŠ¡**
   ```bash
   python app.py
   ```

2. **æ‰“å¼€æµ‹è¯•é¡µé¢**
   
   åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
   ```
   http://localhost:8010/preset-audio-test.html
   ```

3. **ç‚¹å‡»æŒ‰é’®æµ‹è¯•**
   
   ç‚¹å‡»ä»»æ„é¢„è®¾éŸ³é¢‘æŒ‰é’®ï¼Œå³å¯çœ‹åˆ°æ•ˆæœï¼

## ğŸ“– è¯¦ç»†é…ç½®è¯´æ˜

### éŸ³é¢‘æ ¼å¼è¦æ±‚

- **é‡‡æ ·ç‡**ï¼š16kHz
- **æ ¼å¼**ï¼šWAV (PCM)
- **å£°é“**ï¼šå•å£°é“
- **ä½æ·±åº¦**ï¼š16-bit

### å›¾åƒåºåˆ—è¦æ±‚

- **æ ¼å¼**ï¼šJPEG æˆ– PNG
- **åˆ†è¾¨ç‡**ï¼šä¸æ‚¨çš„æ•°å­—äººæ¨¡å‹ä¸€è‡´
- **å¸§ç‡**ï¼š25fps
- **å‘½å**ï¼šæ•°å­—åºåˆ—ï¼ˆ0000.jpg, 0001.jpg, ...ï¼‰
- **å¸§æ•°è®¡ç®—**ï¼š`å¸§æ•° = éŸ³é¢‘ç§’æ•° Ã— 25`

### é…ç½®æ–‡ä»¶è¯´æ˜

`data/custom_config.json` æ ¼å¼ï¼š

```json
[
   {
        "audiotype": 2,                              // é¢„è®¾IDï¼ˆå¿…é¡»å”¯ä¸€ï¼‰
        "imgpath": "data/custom_audio/welcome/image", // å›¾åƒåºåˆ—è·¯å¾„
        "audiopath": "data/custom_audio/welcome/audio.wav" // éŸ³é¢‘æ–‡ä»¶è·¯å¾„
   }
]
```

## ğŸ¯ API ä½¿ç”¨

### æ’­æ”¾é¢„è®¾éŸ³é¢‘

```javascript
fetch('http://localhost:8010/set_audiotype', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        sessionid: 0,      // ä¼šè¯ID
        audiotype: 2,      // é¢„è®¾éŸ³é¢‘ID
        reinit: true       // æ˜¯å¦ä»å¤´æ’­æ”¾
    })
});
```

### ä¸­æ–­æ’­æ”¾

```javascript
fetch('http://localhost:8010/interrupt_talk', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        sessionid: 0
    })
});
```

## ğŸ¨ è‡ªå®šä¹‰é¢„è®¾

### æ–¹æ³•1ï¼šä¿®æ”¹ç”Ÿæˆè„šæœ¬

ç¼–è¾‘ `generate_preset_audio.py`ï¼Œåœ¨ `main()` å‡½æ•°ä¸­æ·»åŠ è‡ªå·±çš„é¢„è®¾ï¼š

```python
presets = [
    {
        "name": "my_welcome",
        "audiotype": 100,
        "text": "ä½ å¥½ï¼Œæ¬¢è¿å…‰ä¸´ï¼"
    },
    # ... æ·»åŠ æ›´å¤š
]
```

ç„¶åè¿è¡Œï¼š
```bash
python generate_preset_audio.py
```

### æ–¹æ³•2ï¼šä½¿ç”¨å…¶ä»–TTSæœåŠ¡

å¦‚æœæ‚¨æƒ³ä½¿ç”¨GPT-SoVITSã€Azure TTSç­‰å…¶ä»–æœåŠ¡ï¼Œå¯ä»¥ï¼š

1. ä½¿ç”¨å¯¹åº”æœåŠ¡ç”ŸæˆéŸ³é¢‘æ–‡ä»¶
2. ä¿å­˜ä¸º16kHz WAVæ ¼å¼
3. æ‰‹åŠ¨ç¼–è¾‘ `data/custom_config.json`
4. å‡†å¤‡å¯¹åº”çš„å›¾åƒåºåˆ—

### æ–¹æ³•3ï¼šç›´æ¥å½•åˆ¶éŸ³é¢‘

1. ç”¨ä¸“ä¸šè®¾å¤‡å½•åˆ¶çœŸäººè¯­éŸ³
2. è½¬æ¢ä¸º16kHz WAVæ ¼å¼
3. é…ç½®åˆ° `custom_config.json`
4. ç”Ÿæˆå¯¹åº”çš„æ•°å­—äººå›¾åƒåºåˆ—

## ğŸ’¡ å®ç”¨æŠ€å·§

### æŠ€å·§1ï¼šæ™ºèƒ½åˆ‡æ¢ï¼ˆé¢„è®¾ vs å®æ—¶TTSï¼‰

```javascript
async function smartResponse(userText) {
    // æ£€æŸ¥æ˜¯å¦åŒ¹é…é¢„è®¾
    const presets = {
        'è¥ä¸šæ—¶é—´': 11,
        'åœ°å€': 12,
        'ä»·æ ¼': 14
    };
    
    for (let [keyword, audiotype] of Object.entries(presets)) {
        if (userText.includes(keyword)) {
            // ä½¿ç”¨é¢„è®¾éŸ³é¢‘ï¼ˆé›¶å»¶è¿Ÿï¼‰
            await playPreset(audiotype);
            return;
        }
    }
    
    // ä½¿ç”¨å®æ—¶TTS
    await fetch('/human', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            sessionid: 0,
            type: 'chat',
            text: userText
        })
    });
}
```

### æŠ€å·§2ï¼šæŒ‰æ—¶æ®µè‡ªåŠ¨é—®å€™

```javascript
function getGreetingType() {
    const hour = new Date().getHours();
    if (hour < 12) return 3;      // æ—©ä¸Šå¥½
    if (hour < 18) return 4;      // ä¸‹åˆå¥½
    return 5;                      // æ™šä¸Šå¥½
}

// ç”¨æˆ·è¿›å…¥æ—¶è‡ªåŠ¨é—®å€™
playPreset(getGreetingType());
```

### æŠ€å·§3ï¼šé¢„è®¾éŸ³é¢‘é˜Ÿåˆ—

```javascript
async function playSequence(audiotypes) {
    for (let audiotype of audiotypes) {
        await playPreset(audiotype);
        await sleep(2000); // ç­‰å¾…2ç§’
    }
}

// æ’­æ”¾æ¬¢è¿åºåˆ—
playSequence([2, 3, 11]); // æ¬¢è¿è¯­ -> é—®å€™ -> è¥ä¸šæ—¶é—´
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šç‚¹å‡»æŒ‰é’®æ²¡ååº”

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`http://localhost:8010`
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹é”™è¯¯
3. æ£€æŸ¥ `data/custom_config.json` æ˜¯å¦å­˜åœ¨
4. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—

### é—®é¢˜ï¼šæç¤ºæ‰¾ä¸åˆ°audiotype

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ `data/custom_config.json` ä¸­æœ‰å¯¹åº”çš„ audiotype
2. é‡å¯æœåŠ¡ä»¥é‡æ–°åŠ è½½é…ç½®
3. æ£€æŸ¥é…ç½®æ–‡ä»¶JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šæ’­æ”¾æ²¡æœ‰å£°éŸ³

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤éŸ³é¢‘æ–‡ä»¶è·¯å¾„æ­£ç¡®
3. éªŒè¯éŸ³é¢‘æ ¼å¼ï¼ˆ16kHz WAVï¼‰
4. æ£€æŸ¥å›¾åƒåºåˆ—æ˜¯å¦å­˜åœ¨

### é—®é¢˜ï¼šå›¾åƒä¸æ˜¾ç¤ºæˆ–é—ªçƒ

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤å›¾åƒåºåˆ—å­˜åœ¨ä¸”å‘½åæ­£ç¡®ï¼ˆ0000.jpg, 0001.jpg...ï¼‰
2. æ£€æŸ¥å›¾åƒæ•°é‡æ˜¯å¦ä¸éŸ³é¢‘æ—¶é•¿åŒ¹é…
3. éªŒè¯å›¾åƒæ ¼å¼å’Œåˆ†è¾¨ç‡

## ğŸ“š æ›´å¤šèµ„æº

- **è¯¦ç»†æ–‡æ¡£**ï¼š[é¢„è®¾éŸ³é¢‘ä½¿ç”¨æŒ‡å—.md](é¢„è®¾éŸ³é¢‘ä½¿ç”¨æŒ‡å—.md)
- **æµ‹è¯•é¡µé¢**ï¼š[http://localhost:8010/preset-audio-test.html](http://localhost:8010/preset-audio-test.html)
- **ç”Ÿæˆè„šæœ¬**ï¼š`generate_preset_audio.py`

## ğŸ‰ é¢„è®¾éŸ³é¢‘IDå‚è€ƒ

| ID | åç§° | ç”¨é€” |
|----|------|------|
| 1  | idle | é™é»˜/å¾…æœº |
| 2  | welcome | æ¬¢è¿è¯­ |
| 3  | greeting_morning | æ—©ä¸Šå¥½ |
| 4  | greeting_afternoon | ä¸‹åˆå¥½ |
| 5  | greeting_evening | æ™šä¸Šå¥½ |
| 11 | faq_hours | è¥ä¸šæ—¶é—´ |
| 12 | faq_location | åœ°å€ä½ç½® |
| 13 | faq_contact | è”ç³»æ–¹å¼ |
| 14 | faq_price | ä»·æ ¼å¥—é¤ |
| 15 | faq_features | åŠŸèƒ½ä»‹ç» |
| 20 | goodbye | å†è§/ç»“æŸ |
| 21 | transfer_human | è½¬äººå·¥å®¢æœ |
| 22 | not_understand | æœªç†è§£ |

## âš¡ æ€§èƒ½ä¼˜åŠ¿

ä½¿ç”¨é¢„è®¾éŸ³é¢‘ vs å®æ—¶TTSå¯¹æ¯”ï¼š

| é¡¹ç›® | é¢„è®¾éŸ³é¢‘ | å®æ—¶TTS |
|------|----------|---------|
| å“åº”å»¶è¿Ÿ | **0ms** | 1-3ç§’ |
| éŸ³è´¨ç¨³å®šæ€§ | **100%** | ä¾èµ–ç½‘ç»œ |
| å¹¶å‘èƒ½åŠ› | **æé«˜** | å—é™äºTTSæœåŠ¡ |
| æˆæœ¬ | **ä¸€æ¬¡æ€§** | æŒ‰è°ƒç”¨æ¬¡æ•° |

---

**å¼€å§‹äº«å—é›¶å»¶è¿Ÿçš„æ•°å­—äººä½“éªŒå§ï¼** ğŸŠ
